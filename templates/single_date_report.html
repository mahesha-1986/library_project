<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Single Date Report</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
  <div class="max-w-5xl mx-auto mt-10 p-6 bg-white rounded-lg shadow-lg" style="background: linear-gradient(135deg, #e0e7ff 0%, #f3f4f6 100%);">
    
    <!-- College Header -->
    <div class="flex flex-col md:flex-row items-center gap-4 border-b border-gray-300 pb-4 mb-6">
      <img 
        src="{{ url_for('static', filename='logo-removebg-preview.png') }}" 
        alt="College Logo" 
        class="h-20 md:h-24 w-auto object-contain"
      />
      <div class="text-center md:text-left">
        <h1 class="text-xl md:text-3xl font-bold text-[#6b1111] tracking-wide">
          Dr. B. B. Hegde First Grade College, Kundapura
        </h1>
        <p class="text-sm md:text-base text-gray-700 mt-1">
          A Unit of Coondapur Education Society (R)
        </p>
      </div>
    </div>

    <!-- Report Title & Home -->
    <div class="flex justify-between items-center mb-4">
      <h1 class="text-2xl font-bold text-gray-800">Single Date Book Transaction Report</h1>
      <a href="{{ url_for('home') }}" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold px-4 py-2 rounded-lg transition-all shadow-sm">Home</a>
    </div>
    
    <!-- Date Selection and Download Button -->
    <form method="POST" class="flex flex-wrap items-center gap-4 mb-6 inline-block">
      <label for="report_date" class="font-semibold text-gray-700">Select Date:</label>
      <input type="date" id="report_date" name="report_date" required 
             class="border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
      <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-5 rounded-lg shadow-md transition-all">Search</button>

      <!-- Download button appears only if data is available -->
      {% if report_data %}
      </form>
      <form method="POST" action="{{ url_for('download_single_date_report') }}" class="inline-block mb-2">
        <input type="hidden" name="report_date" value="{{ selected_date }}" />
        <button type="submit" 
                class="flex items-center gap-2 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="18" height="18">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v2a2 2 0 002 2h12a2 2 0 002-2v-2M7 10l5 5 5-5M12 4v11" />
          </svg>
          Download
        </button>
      </form>
      {% endif %}
    </form>
    
    <!-- Report Table -->
    {% if report_data %}
    <div class="w-full relative" id="tableScrollContainer" style="overflow: hidden;">
      <table class="min-w-full table-fixed border border-gray-300 rounded text-xs md:text-sm bg-white shadow-md" style="user-select:none;">
        <thead class="bg-gradient-to-r from-blue-600 to-blue-700 text-white">
          <tr>
            <th class="px-2 py-2 whitespace-nowrap">S.No</th>
            <th class="px-2 py-2 whitespace-nowrap">Student Name</th>
            <th class="px-2 py-2 whitespace-nowrap">Roll No</th>
            <th class="px-2 py-2 whitespace-nowrap">Class</th>
            <th class="px-2 py-2 whitespace-nowrap">Book Title</th>
            <th class="px-2 py-2 whitespace-nowrap">Author</th>
            <th class="px-2 py-2 whitespace-nowrap">Department</th>
            <th class="px-2 py-2 whitespace-nowrap">Barcode</th>
            <th class="px-2 py-2 whitespace-nowrap">Issued Date</th>
            <th class="px-2 py-2 whitespace-nowrap">Returned Date</th>
            <th class="px-2 py-2 whitespace-nowrap">Status</th>
          </tr>
        </thead>
        <tbody>
          {% for book in report_data %}
          <tr class="border-b text-xs hover:bg-blue-50 transition">
            <td class="px-2 py-2">{{ loop.index }}</td>
            <td class="px-2 py-2">{{ book.student.studentName }}</td>
            <td class="px-2 py-2">{{ book.student.rollno }}</td>
            <td class="px-2 py-2">{{ book.student.section }}</td>
            <td class="px-2 py-2">{{ book.book.title }}</td>
            <td class="px-2 py-2">{{ book.book.author }}</td>
            <td class="px-2 py-2">{{ book.book.department }}</td>
            <td class="px-2 py-2">{{ book.book.barcode }}</td>
            <td class="px-2 py-2">{{ book.issued_at }}</td>
            <td class="px-2 py-2">{{ book.returned_at if book.returned_at else 'N/A' }}</td>
            <td class="px-2 py-2">{{ book.status }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    
    <!-- Horizontal Drag Scroll -->
    <script>
      const tableContainer = document.getElementById('tableScrollContainer');
      let isDown = false;
      let startX;
      let scrollLeft;
      tableContainer.addEventListener('mousedown', (e) => {
        isDown = true;
        tableContainer.classList.add('cursor-grabbing');
        startX = e.pageX - tableContainer.offsetLeft;
        scrollLeft = tableContainer.scrollLeft;
      });
      tableContainer.addEventListener('mouseleave', () => {
        isDown = false;
        tableContainer.classList.remove('cursor-grabbing');
      });
      tableContainer.addEventListener('mouseup', () => {
        isDown = false;
        tableContainer.classList.remove('cursor-grabbing');
      });
      tableContainer.addEventListener('mousemove', (e) => {
        if (!isDown) return;
        e.preventDefault();
        const x = e.pageX - tableContainer.offsetLeft;
        const walk = (x - startX) * 1.5;
        tableContainer.scrollLeft = scrollLeft - walk;
      });
    </script>
    
    {% elif selected_date %}
      <div class="text-center text-gray-500 mt-6">No records found for {{ selected_date }}.</div>
    {% endif %}
  </div>
</body>
</html>
